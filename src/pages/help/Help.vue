<template>
  <t-popup v-model="popupShow" placement="center" style="width: 80%">
    <div class="pop-title">ç®€ä»‹</div>
    <div style="font-size: 15px; padding: 0 15px 30px">
      <br />&emsp;&emsp;ä½ çŸ¥é“æµæµªçŒ«æ˜¯æ€ä¹ˆè¿‡å†¬çš„å—ï¼Ÿå¢™è§’é‡Œã€è‰ä¸›ä¸­ã€è½¦åº•ä¸‹ï¼Œè¿˜æœ‰æ— å¤„å¯å»çš„ç›´æ¥è¢«é€å¾€äº†å–µæ˜Ÿã€‚æ¯”èµ·é…·æš‘ï¼Œä¸¥å¯’æ‰æ˜¯æµæµªçŒ«æœ€å¤§çš„æŒ‘æˆ˜ã€‚
      <br />&emsp;&emsp;æ¯å¹´å†¬å¤©ï¼Œè‡³å°‘æœ‰60%çš„æµæµªçŒ«ï¼Œå› ä¸ºæ‰›ä¸ä½è¿™å‡›å†½çš„å¯’é£è€Œè¢«é£è¿”å–µæ˜Ÿï¼Œè¿™ä¹Ÿæ˜¯æµæµªçŒ«å¯¿å‘½çŸ­çš„åŸå› ã€‚ä½ å¯èƒ½ä¼šè¯´ï¼šâ€œæµæµªçŒ«ä¸€èº«æ¯›å‘æ€å°±ä¸æŠ—å†»å‘¢ï¼Ÿâ€
      <br />&emsp;&emsp;å…¶å®ï¼ŒçŒ«å’ªè¿œæ¯”æˆ‘ä»¬æƒ³è±¡çš„è¦æ›´æ€•å†·ï¼Œå®ƒä»¬çš„ç¥–å…ˆèµ·æºäºæ²™æ¼ ï¼Œæ›´é€‚åº”æ¸©æš–çš„ç¯å¢ƒã€‚ä¸”å¤§å¤šæ•°çŒ«å’ªçš„æ¯›è¢«å±‚æ¬¡å°‘ï¼Œä¿æš–æ€§å·®ï¼ŒæŠ—å¯’èƒ½åŠ›å¹¶ä¸é«˜ã€‚æ‰€ä»¥ï¼ŒçŒ«å’ªä¸€åˆ°å†¬å¤©å°±å–œæ¬¢å¾€å„ç§æš–å’Œçš„åœ°æ–¹é’»ï¼Œå¹¶ä¸”æµæµªçŒ«åœ¨å†¬å¤©èƒ½è·å¾—çš„é£Ÿç‰©ä¹Ÿæ›´å°‘ï¼Œå¦‚æ­¤é¥¥å¯’äº¤è¿«çš„æƒ…å†µä¸‹ï¼Œå¾ˆéš¾ç†¬è¿‡è¿™æ®‹é…·çš„å†¬å¤©ã€‚
      <br />&emsp;&emsp;å¦‚æœæˆ‘ä»¬èƒ½ç»™å®ƒä»¬ä¸€ç‚¹æ¸©æš–ï¼Œæ¯”å¦‚:ä¸€ä¸ªå†™ä¸Šæé†’è¯­çš„çº¸ç®±å¡ä¸Šä¸€äº›è¡£ç‰©ã€ä¸€å°ç¢—æ¸©æ°´å’ŒçŒ«ç²®ã€æˆ–æ˜¯åœ¨å¼€è½¦å‰æ£€æŸ¥ä¸€ä¸‹è½¦åº•å’Œè½®èƒï¼Œæˆ–è®¸å°±èƒ½æŒ½å›ä¸€æ¡å°å°çš„ç”Ÿå‘½......
    </div>
    <t-icon class="close-btn" name="close-circle" size="32" color="#fff" @click="popupShow = false" />
  </t-popup>
  <div class="all">
    <div class="section">
      <vue-danmaku v-model:danmus="danmus" loop style="height:100px; width:100%;" :speeds=70 :top=10 :right=8
        randomChannel :fontSize=16 extraStyle="background-color: #00000058;padding: 5px 8px;border-radius: 50px;" />
    </div>

    <div class="title0 flex-row">
      <div :class="isActive == 0 ? 'onclick' : 'unclick'" @click="chenked(0)">
        <text>æ´åŠ©è®¡åˆ’</text>
      </div>

      <div :class="isActive == 1 ? 'onclick1' : 'unclick'" @click="chenked(1)">
        <text>é¢†å…»å® ç‰©</text>
      </div>
    </div>

    <div v-show="isActive == 0" class="plan">
      <div class="mid">
        <div class="flex-row justify-center">
          <div class="main_title" style="margin-bottom: 8px">
            ã€Šç¬¬ä¸‰æœŸ è®©æµæµªçš„ä»–ä»¬ä¸å†å¯’å†·ã€‹
          </div>
        </div>
        <video class="flex-row justify-center" style="width: 100%" controls :src="videoSrc"></video>
        <div class="flex-row justify-between items-center" style="margin-top: 6px">
          <text style="font-size: 18px; font-weight: bold">è®©æµæµªçš„ä»–ä»¬ä¸å†å¯’å†·</text>
          <div class="flex-row items-center" @click="popupShow = true">
            <text style="padding-bottom: 2px">ç®€ä»‹</text>
            <t-icon name="chevron-right" size="18" style="color: #7c7c7c" />
          </div>
        </div>

        <div class="text2">
          <text style="color: darkgray">æœŸæœ›æ´åŠ©</text>
          <img class="icon" src="@/assets/images/help/bone.png" />
          <text class="text3">22000KG</text>
          <img class="icon" src="@/assets/images/help/fishbone.png" />
          <text class="text3">18000KG</text>
        </div>
        <div class="text2">
          <text style="color: darkgray">æ´åŠ©æ–¹å¼</text>
          <text class="text3" style="color: #ff7a91">8KGæ—§è¡£=1KGé¥²æ–™</text>
        </div>
      </div>
      <div class="mid">
        <div class="title">
          <t-icon name="user-circle" size="30" style="color: #ff7a92; margin-right: 8px" />
          <text class="myhelp">æˆ‘çš„æ´åŠ©</text>
        </div>

        <div>
          <DonationCard imgSrc="src/assets/images/help/bone.png" :requiredWeight="22000" :currentWeight="num1"
            :participants="618" description="ç‹—ç²®éœ€æ—§è¡£é‡é‡" :type="1" />
          <DonationCard imgSrc="src/assets/images/help/fishbone.png" :requiredWeight="12000" :currentWeight="num2"
            :participants="798" description="çŒ«ç²®éœ€æ—§è¡£é‡é‡" :type="2" />
        </div>
      </div>
      <div class="mid">
        <div class="flex-row justify-center">
          <div class="main_title" style="color: #ff7a92de;margin-bottom: 10px;">
            ã€Šå¾€æœŸå›é¡¾ã€‹
          </div>
        </div>
        <HelpCard :id="2" boxClass="" imageSrc="src/assets/images/help/dog.png" title="(ç¬¬2æœŸ) æ‹¾èµ·è¢«é—å¼ƒçš„çˆ±"
          targetWeight="25200kg" totalWeight="25715kg" participants="1904äºº" @click="navToDetail(2)" />
        <HelpCard :id="1" boxClass="box1" imageSrc="src/assets/images/help/cat.png" title="(ç¬¬1æœŸ) ç”¨çˆ±ç»ˆç»“æµæµª"
          targetWeight="19200kg" totalWeight="23869kg" participants="1867äºº" @click="navToDetail(1)" />
      </div>
    </div>
    <div v-if="isActive == 1" class="plan">
      <div class="mid" style="padding: 12px 0">
        <t-tabs default-value="0" @change="onChange">
          <t-tab-panel value="0">
            <template #label>
              <div>çŒ«çŒ«</div>
            </template>
          </t-tab-panel>
          <t-tab-panel value="1">
            <template #label>ç‹—ç‹—</template>
          </t-tab-panel>
        </t-tabs>
        <div v-show="current == 0">
          <div style="flex-wrap: wrap" class="flex-row">
            <div class="flex-col" style="width: 40vw; margin: 10px" v-for="(item, index) in catList" :key="index">
              <img class="img_item" :src="item.image" />
              <div style="margin: 4px auto;">
                {{ item.name }}
              </div>
              <div class="flex-row items-center justify-between">
                <div>
                  <t-icon name="location" size="18" color="#999"></t-icon>
                  <text style="margin-left: 3px">{{ item.province }}</text>
                </div>
                <t-button theme="primary" shape="round" style="height: 28px"
                  @click="openAdoptDialog(item)">é¢†å…»</t-button>
              </div>
            </div>
          </div>
        </div>
        <div v-show="current == 1">
          <div style="flex-wrap: wrap" class="flex-row">
            <div class="flex-col" style="width: 40vw; margin: 10px" v-for="(item, index) in dogList" :key="index">
              <img class="img_item" :src="item.image" />
              <div style="margin: 4px auto;">
                {{ item.name }}
              </div>
              <div class="flex-row items-center justify-between">
                <div>
                  <t-icon name="location" size="18" color="#999"></t-icon>
                  <text style="margin-left: 3px;">{{ item.province }}</text>
                </div>
                <t-button theme="primary" shape="round" style="height: 28px"
                  @click="openAdoptDialog(item)">é¢†å…»</t-button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- é¢†å…»ç¡®è®¤å¼¹çª— -->
      <t-dialog v-model:visible="showAdoptDialog" title="é¢†å…»ç¡®è®¤" :confirm-btn="{ content: 'ç¡®è®¤', theme: 'primary' }"
        :cancel-btn="{ content: 'å–æ¶ˆ' }" @confirm="handleAdopt" @cancel="showAdoptDialog = false">
        <div>
          <p style="color: black;">æ‚¨ç¡®å®šè¦é¢†å…»è¿™åªå¯çˆ±çš„å°ä¼™ä¼´å—ï¼Ÿ</p>
          <p style="color: #999; font-size: 14px">é¢†å…»éœ€è¦æ‰¿æ‹…ç›¸åº”çš„è´£ä»»å’Œä¹‰åŠ¡</p>
        </div>
      </t-dialog>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import vueDanmaku from 'vue3-danmaku'
import DonationCard from '@/components/DonationCard.vue'
import HelpCard from '@/components/HelpCard.vue'
import { getCatListData, getDogListData, updateAdoptionInfo } from '@/api/help.js'
import {
  MessagePlugin
} from 'tdesign-mobile-vue';
import { storeToRefs } from "pinia";
import useUserInfoStore from "@/store/user.js";

const userInfoStore = useUserInfoStore();
const { userName } = storeToRefs(userInfoStore)
const danmus = ref([])

onMounted(() => {
  setInterval(() => {
    const random = Math.floor(Math.random() * 3)
    // éšæœºç”Ÿæˆç”¨æˆ·å
    var randomUsername = "ç”¨æˆ·" + Math.floor(Math.random() * 1000);
    // éšæœºç”Ÿæˆ1åˆ°39ä¹‹é—´çš„æ•°å­—
    var randomNumber = Math.floor(Math.random() * 39) + 1;
    danmus.value.push(`${new Array(random).fill('~').join('ğŸ¤©')}${randomUsername}æèµ ${randomNumber}kgæ—§ç‰© ğŸ¥°`)
  }, Math.floor(Math.random() * 1000))

  getCatListData().then(res => {
    catList.value = res.list.filter(item => item.status !== 1)

  })

  getDogListData().then(res => {
    dogList.value = res.list.filter(item => item.status !== 1)
  })
})

const router = useRouter()

const catList = ref([])
const dogList = ref([])

const onChange = (index) => {
  current.value = index
}
const num1 = ref(8000)
const num2 = ref(10000)
const isActive = ref(0)
const popupShow = ref(false)
const videoSrc = import.meta.env.VITE_VIDEO_URL + '/0.mp4'
const current = ref(0)

const showAdoptDialog = ref(false)
const currentPet = ref(null)

const openAdoptDialog = (pet) => {
  currentPet.value = pet
  showAdoptDialog.value = true
}

const handleAdopt = () => {
  updateAdoptionInfo({
    ...currentPet.value,
    adopter: userName.value,
  })
  MessagePlugin.success('é¢†å…»ç”³è¯·å·²æäº¤ï¼Œæˆ‘ä»¬ä¼šå°½å¿«è”ç³»æ‚¨ï¼')
  showAdoptDialog.value = false
}

const chenked = (e) => {
  isActive.value = e
}

const navToDetail = (i) => {
  router.push('/helpdetail' + i)
}

</script>
<style scoped>
.pop-title {
  text-align: center;
  font-size: 20px;
  font-weight: bold;
  padding-top: 10px;
}

.close-btn {
  position: absolute;
  left: 50%;
  margin-left: -16px;
  bottom: calc(-1 * (24px + 32px));
}

.myhelp {
  color: #ff7a92;
  font-size: 26px;
  font-family: abc;
  margin-right: 9px;
}

.img_item {
  height: 150px;
  width: 40vw;
  border-radius: 15px;
}

.title {
  text-align: center;
  color: #000;
  font-size: 19px;
  margin-top: 5px;
}

.all {
  background-color: #ddeef8;
}

.section {
  padding: 80px 0 120px;
  background-image: url('@/assets/images/help/12.jpg');
  background-size: 100% 100%;
  background-repeat: no-repeat;
}

.main_title {
  font-size: 29px;
  font-family: abc;
  color: #76b0d8d1;
}



@keyframes fontAnimation {
  from {
    font-size: 20px;
    font-weight: 400;
  }

  to {
    font-size: 25px;
    font-weight: 600;
  }
}

.onclick {
  height: 60px;
  width: 50%;
  border-radius: 24px 24px 0 0;
  background: linear-gradient(to bottom, #f7f0f0, #ddeef8);
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 25px;
  padding-top: 10px;
  color: #76b0d8;
  position: relative;
  font-weight: 600;

  animation: fontAnimation 0.3s ease-out;
}

.onclick:before {
  position: absolute;
  right: -30px;
  bottom: 0px;
  content: '';
  display: inline-block;
  width: 30px;
  background: #ffffff;
  height: 30px;
  border-bottom-left-radius: 24px 24px;
  z-index: 2;
}

.onclick:after {
  position: absolute;
  display: inline-block;
  content: '';
  right: -30px;
  bottom: -1px;
  width: 33px;
  height: 30px;
  background: linear-gradient(to bottom, #e8edf4, #deeef7);
  z-index: 1;
}

.onclick1 {
  height: 60px;
  width: 50%;
  border-radius: 24px 24px 0 0;
  background: linear-gradient(to bottom, #f7f0f0, #ddeef8);
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 25px;
  padding-top: 10px;
  color: #76b0d8;
  position: relative;
  font-weight: 600;
  animation: fontAnimation 0.3s ease-out;
}

.onclick1:before {
  position: absolute;
  bottom: 0px;
  left: -30px;

  content: '';
  display: inline-block;
  width: 30px;
  background: #ffffff;
  height: 30px;
  border-bottom-right-radius: 24px 24px;
  z-index: 2;
}

.onclick1:after {
  position: absolute;
  display: inline-block;
  content: '';
  left: -30px;
  bottom: -1px;
  width: 30px;
  height: 30px;
  background: linear-gradient(to bottom, #e8edf4, #deeef7);
  z-index: 1;
}

.unclick {
  height: 50px;
  width: 50%;
  background-color: #ffffff;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 20px;
}

.title {
  display: flex;
  flex-flow: row;
  justify-content: center;
}

.title0 {
  margin-top: -10px;
  align-items: flex-end;
  height: 50px;
  background-color: #ffffff;
  border-radius: 50%;
  font-family: ali;
  font-weight: 500;
}

.plan {
  padding: 5px 18px 66px;
}

.mid {
  margin-top: 10px;
  background-color: white;
  border-radius: 10px;
  padding: 12px 17px;
}

.card {
  margin-top: 10px;
}

.text2 {
  line-height: 21px;
  display: flex;
  align-items: center;
  font-size: 14px;
  margin-top: 6px;
}

.text3 {
  margin-left: 10px;
  font-weight: bold;
}

.icon {
  width: 26px;
  height: 26px;
  margin-left: 10px;
  background-color: #ffd2d2;
  border-radius: 50%;
}






.multi-back {
  margin-top: 21px;
  display: flex;
  flex-direction: column;
  align-items: center;
  color: darkgray;
}
</style>
